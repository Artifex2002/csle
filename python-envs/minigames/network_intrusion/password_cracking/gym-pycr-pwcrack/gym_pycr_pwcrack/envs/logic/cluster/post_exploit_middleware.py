from typing import Union
from gym_pycr_pwcrack.dao.network.env_state import EnvState
from gym_pycr_pwcrack.dao.network.env_config import EnvConfig
from gym_pycr_pwcrack.dao.action.action import Action
from gym_pycr_pwcrack.envs.logic.cluster.cluster_util import ClusterUtil
from gym_pycr_pwcrack.envs.logic.common.env_dynamics_util import EnvDynamicsUtil
import gym_pycr_pwcrack.constants.constants as constants

class PostExploitMiddleware:
    """
    Class that implements functionality for executing post-exploits actions on the cluster
    """

    @staticmethod
    def execute_ssh_login(s: EnvState, a: Action, env_config: EnvConfig) -> Union[EnvState, int, bool]:
        """
        Executes a SSH login on the cluster

        :param s: the current state
        :param a: the action to take
        :param env_config: the environment configuration
        :return: s_prime, reward, done
        """
        s_prime, reward, done = ClusterUtil.login_service_helper(
            s=s, a=a, alive_check=EnvDynamicsUtil.check_if_ssh_connection_is_alive,
            service_name=constants.SSH.SERVICE_NAME, env_config=env_config)
        return s_prime, reward, done

    @staticmethod
    def execute_ftp_login(s: EnvState, a: Action, env_config: EnvConfig) -> Union[EnvState, int, bool]:
        """
        Executes a FTP login on the server

        :param s: the current state
        :param a: the action to take
        :param env_config: the environment configuration
        :return: s_prime, reward, done
        """
        s_prime, reward, done = ClusterUtil.login_service_helper(
            s=s, a=a, alive_check=EnvDynamicsUtil.check_if_ftp_connection_is_alive,
            service_name=constants.FTP.SERVICE_NAME, env_config=env_config)
        return s_prime, reward, done

    @staticmethod
    def execute_telnet_login(s: EnvState, a: Action, env_config: EnvConfig) -> Union[EnvState, int, bool]:
        """
        Executes a telnet login on the server

        :param s: the current state
        :param a: the action to take
        :param env_config: the environment configuration
        :return: s_prime, reward, done
        """
        s_prime, reward, done = ClusterUtil.login_service_helper(
            s=s, a=a, alive_check=EnvDynamicsUtil.check_if_telnet_connection_is_alive,
            service_name=constants.TELNET.SERVICE_NAME, env_config=env_config)
        return s_prime, reward, done

    @staticmethod
    def execute_bash_find_flag(s: EnvState, a: Action, env_config: EnvConfig) -> Union[EnvState, int, bool]:
        """
        Performs a Telnet Dictionary Password Attack action

        :param s: the current state
        :param a: the action to take
        :param env_config: the environment configuration
        :return: s_prime, reward, done
        """
        return s, 0, False