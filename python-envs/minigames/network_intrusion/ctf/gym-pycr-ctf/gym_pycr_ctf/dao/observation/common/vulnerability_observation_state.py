from typing import List
from gym_pycr_ctf.dao.network.transport_protocol import TransportProtocol
from gym_pycr_ctf.dao.network.vulnerability import Vulnerability
from gym_pycr_ctf.dao.network.credential import Credential


class VulnerabilityObservationState:
    """
    A DTO representing an observed vulnerability
    """

    def __init__(self, name : str, port : int, protocol: TransportProtocol, cvss : float, osvdbid: int = None,
                 description : str = None, credentials: List[Credential] = None):
        self.name = name
        self.port = port
        self.protocol = protocol
        self.cvss = cvss
        self.osvdb_id = osvdbid
        self.description = description
        self.credentials = credentials

    def __str__(self):
        """
        :return: a string representation of the observed vulnerability
        """
        return "name:{}, port:{}, protocol:{}, cvss:{}, osvdb_id:{}, desc:{},credentials:{}".format(
            self.name, self.port, self.protocol, self.cvss, self.osvdb_id, self.description,
            list(map(lambda x: str(x), self.credentials)))

    def to_vulnerability(self) -> Vulnerability:
        """
        Converts the object into a vulnerability representation

        :return: A vulnerability representation of the object
        """
        vuln = Vulnerability(name=self.name, port=self.port, protocol= self.protocol, cvss=self.cvss,
                             cve="", service="", credentials=self.credentials)
        return vuln